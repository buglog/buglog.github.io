<!DOCTYPE html>

<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href= "css/reset.css">
<!--just replace with "css/debug.css" to see squares.-->
<link rel="stylesheet" href= "css/~debug.css">
<!-- styling the grid with responsive page design.--> 
<link rel="stylesheet" href= "css/article.css">
<link rel="stylesheet" href= "css/article-image.css"> 
<link rel="stylesheet" href= "css/style.css">

<body>
    <header id="header">
        <h1><a href="/"><span style="color: magenta;">DOLL</span><span style="color: limegreen;">MATH</span></a></h1>
        <!-- Add your navigation bar here -->
    </header>



<article>
    <!-- Content area to inject page HTML -->
  <div id="page-content"></div> 
    <!-- Links will be injected here -->
  <div class="folder-links" id="folder-links">
  </div>

  <div>
    <button class="filter-btn" data-filter="video">video</button>
    <span class="dot-separator"> / </span>
    <button class="filter-btn" data-filter="sculpture">sculpture</button>
    <span class="dot-separator"> / </span>
    <button class="filter-btn" data-filter="image">image</button>
    <span class="dot-separator"> / </span>
    <button class="filter-btn" data-filter="text">text</button>
    <span class="dot-separator"> / </span>
    <button class="filter-btn" data-filter="other">other</button>
    <span class="dot-separator"> / </span>
    <button class="clear-btn" id="clear">clear</button>
  </div>

</article>

<div class = "clicky">
<a class = "clicky" href="https://ddbentl.com/"><img src="https://ddbentl.com/img/bentlbutton.gif" alt="ddbentl" /> </br></a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const folderLinksContainer = document.getElementById('folder-links');
  const contentContainer = document.getElementById('page-content');
  const buttons = document.querySelectorAll('.filter-btn');
  let clickedLinks = JSON.parse(localStorage.getItem('clickedLinks')) || [];
  let dataLookup = {}; // ðŸ‘ˆ Store folder info for reverse lookup later

  fetch('sites/sites.json')
    .then(response => response.json())
    .then(data => {
      if (!Array.isArray(data) || data.length === 0) {
        folderLinksContainer.innerHTML = '<h3>No folder entries found.</h3>';
        return;
      }

      const links = data.map(item => {
        const folder = item.name;
        /*const file = item.file;
        const url = `sites/${folder}/${file}`;*/
        const date = item.date;
        const url = `sites/${folder}/site.html`;
        const type = item.type || 'default';
        const isClicked = clickedLinks.includes(url);

        // Save for hash resolution later
        dataLookup[folder] = { url, type };

        return `<span class="folder-link${isClicked ? ' clicked' : ''}" data-url="${url}" data-folder="${folder}" data-type="${type}">${folder}</span>`;
      });

      folderLinksContainer.innerHTML = links.join(' <span class="dot-separator"> / </span> ');
      addClickHandlers();
      loadInitialFromHash(); // âœ… Load if hash exists
    });

  function addClickHandlers() {
    const links = document.querySelectorAll('.folder-link');

    links.forEach(link => {
      link.addEventListener('click', function () {
        const url = this.dataset.url;
        const folder = this.dataset.folder;

        if (!clickedLinks.includes(url)) {
          clickedLinks.push(url);
          localStorage.setItem('clickedLinks', JSON.stringify(clickedLinks));
        }

        this.classList.add('clicked');

        // âœ… Set URL hash to folder name
        window.location.hash = encodeURIComponent(folder);

        fetchAndDisplay(url);
      });
    });

    // Filter buttons
    buttons.forEach(button => {
      button.addEventListener('click', () => {
        const filter = button.getAttribute('data-filter');
        buttons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        document.querySelectorAll('.folder-link').forEach(link => {
          link.classList.remove('filtered');
          if (link.dataset.type === filter) {
            link.classList.add('filtered');
          }
        });
      });
    });
  }

  function fetchAndDisplay(url) {
    fetch(url)
      .then(response => response.text())
      .then(html => {
        contentContainer.innerHTML = html;
      })
      .catch(err => {
        contentContainer.innerHTML = `<p>Error loading content from ${url}</p>`;
      });
  }

  // âœ… Load page content based on hash (e.g., #myfolder)
  function loadInitialFromHash() {
    const hash = window.location.hash;
    if (hash.length > 1) {
      const folder = decodeURIComponent(hash.slice(1));

      if (dataLookup[folder]) {
        const { url } = dataLookup[folder];

        fetchAndDisplay(url);

        // Highlight the matching link
        document.querySelectorAll(`.folder-link[data-folder="${folder}"]`).forEach(link => {
          link.classList.add('clicked');
        });
      } else {
        contentContainer.innerHTML = `<p>Page "${folder}" not found.</p>`;
      }
    }
  }

  // Clear clicked links
  document.getElementById('clear').addEventListener('click', () => {
    localStorage.removeItem('clickedLinks');

    //remove filtered links
    document.querySelectorAll('.folder-link').forEach(link => {
          link.classList.remove('filtered');
    });

    buttons.forEach(btn => btn.classList.remove('active'));
    // remove clicked links
    document.querySelectorAll('.folder-link.clicked').forEach(link => {
      //link.classList.remove('clicked');
    });

    //contentContainer.innerHTML = '';
    //window.location.hash = ''; // Clear hash from URL too
  });
  // Handle Back/Forward navigation by re-loading content from the hash
window.addEventListener('hashchange', () => {
  loadInitialFromHash();
});

});


</script>

<!--
<footer>
    <article>
    <p>&copy; dollmath.online by inga waste contaminant.</p>
    </article>
</footer>
-->
</body>
</html>